function getCookie(o){for(var n=o+"=",e=document.cookie.split(";"),t=0;t<e.length;t++){for(var r=e[t];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(n))return r.substring(n.length,r.length)}return""}var envApp=angular.module("app_env",["ngResource","env.services","lang.services"]);envApp.controller("ctrl_env",["$scope","env_lang","env","lang","icons","env_projects","projects","$window",function(o,n,e,t,r,a,c,l){function i(o,n,e){console.log("longitud "+o.length),o.length<=0&&(console.log("reload"),e(n),$("#lang-add-modal").modal("hide"))}o.langIconos=r.get({id:"env"}),o.iconSelected,o.langs=[],o.envs=e.query(function(o){},function(n){o.showMessage(o.getDataError(n))}),o.GencoEntorno=new e,o.GencoProyectos=new c,o.tmpGencoEntorno,o.descripcion="",o.nombre="",o.id_grupo="",o.icono="",o.wdnMode=0,o.ConfirmDeleteCallback=null,o.envProjects=null,o.all_langs=t.query(),o.load_env=function(t){e.get({id:t}).$promise.then(function(e){o.GencoEntorno=e,o.descripcion=e.descripcion,o.nombre=e.nombre,o.icono=e.icon.upload,o.tmpGencoEntorno=o.GencoEntorno,o.langs=n.get({id:t}),$("#dropEnvOptions").attr("disabled",!1),o.chooseBuild()})},o.chooseBuild=function(){a.get({id_env:o.GencoEntorno.id_entorno},function(n){o.envProjects=n},function(n){o.showMessage(o.getDataError(n))})},o.goEditor=function(){console.log("goEditor"),o.langs.length>0?l.location.href="module/editor/"+o.GencoEntorno.id_entorno:o.showMessage("There isn't a language for this environment")},o.saveOrUpdate=function(){var n=o.wdnMode;1==n?o.save():2==n&&o.update()},o.save=function(){o.GencoEntorno.$save(function(n){o.envs=e.query(),$("#env-modal").modal("hide")},function(n){o.showMessage(o.getDataError(n))})},o.update=function(){o.GencoEntorno.$update(function(n){o.envs=e.query(),o.load_env(o.GencoEntorno.id_entorno),$("#env-modal").modal("hide")},function(n){o.showMessage(o.getDataError(n))})},o.delete=function(){o.GencoEntorno.$delete(function(n){o.envs=e.query(),o.descripcion="",o.nombre="",o.id_grupo="",o.icono=""},function(n){o.showMessage(o.getDataError(n))})},o.cancel=function(){o.GencoEntorno=o.tmpGencoEntorno,$("#env-modal").modal("hide"),$("#lang-add-modal").modal("hide")},o.new=function(){o.wdnMode=1,o.tmpGencoEntorno=o.GencoEntorno,o.GencoEntorno=new e,$("#env-modal").modal("show").on("shown.bs.modal",function(){$("#id_nombre").focus()})},o.edit=function(){o.wdnMode=2,o.tmpGencoEntorno=o.GencoEntorno,o.setEnvIcon(o.GencoEntorno.icon),$("#env-modal").modal("show").on("shown.bs.modal",function(){$("#id_nombre").focus()})},o.remove=function(){o.showConfirmDelete("Do you really want to delete "+o.GencoEntorno.nombre+" environment"),o.ConfirmDeleteCallback=function(){o.delete()}},o.all_lang_init=function(){o.lang_added=o.all_langs.map(function(n){var e=!1;return angular.forEach(o.langs,function(o,t){console.log(o.id_lenguaje),console.log(n.id_lenguaje),o.id_lenguaje!=n.id_lenguaje||(e=!0)}),e}),console.log(o.lang_added)},o.create_project=function(){o.GencoProyectos=new c,$("#create-project-modal").modal("show")},o.save_project=function(){project=new c({id_entorno:o.GencoEntorno.id_entorno,nombre:o.GencoProyectos.nombre,descripcion:o.GencoProyectos.descripcion}),project.$save(function(n){o.envProjects.push(n),$("#create-project-modal").modal("hide")},function(n){o.showMessage(o.getDataError(n))})},o.save_add_lang=function(){console.log(o.lang_added),index=0,proccess=[];var e=0;angular.forEach(o.lang_added,function(t,r){e=0,angular.forEach(o.langs,function(n,t){if(n.id_lenguaje==o.all_langs[r].id_lenguaje)return console.log("encontrado"),console.log(o.langs[t]),void(e=parseInt(o.langs[t].id_entornolenguaje))}),t?0==e&&(console.log(o.all_langs[r]),proccess.push(1),conv=new n({id_entorno:o.GencoEntorno.id_entorno,id_lenguaje:o.all_langs[r].id_lenguaje}),console.log(conv),conv.$save(function(n){proccess.pop(),i(proccess,o.GencoEntorno.id_entorno,o.load_env)},function(n){o.showMessage(o.getDataError(n)),proccess.pop(),i(proccess,o.GencoEntorno.id_entorno,o.load_env)})):e>0&&(proccess.push(1),conv=new n({id_entorno:o.GencoEntorno.id_entorno,id_lenguaje:o.all_langs[r].id_lenguaje}),conv.$delete({id:e},function(n){proccess.pop(),i(proccess,o.GencoEntorno.id_entorno,o.load_env)},function(n){o.showMessage(o.getDataError(n)),proccess.pop(),i(proccess,o.GencoEntorno.id_entorno,o.load_env)})),index++})},o.setEnvIcon=function(n){o.GencoEntorno.id_icono=n.id_icono,console.log(n),$("#imgEnvIconAdd").attr("src",n.upload)},o.showMessage=function(o){$("#imConfirm").html(o),$("#info-modal").modal("show")},o.showConfirmDelete=function(o){$("#tedmConfirm").html(o),$("#confirm-delete-modal").modal("show")},o.confirm_delete=function(){o.ConfirmDeleteCallback(),$("#confirm-delete-modal").modal("hide")},o.getDataError=function(o){if(null!=o.data.detail)return o.data.detail;if(null!=o.data){var n="";if(o.data instanceof Array||o.data instanceof Object)angular.forEach(o.data,function(o,e){n+=e+" - "+o+"<br/>"});else{var e=JSON.stringify(o.data);if(console.log(o.data),console.log(e.substring(1,10)),console.log(e.substring(1,6)),"<!DOCTYPE"==e.substring(1,10)||"html"==e.substring(1,6))return o.data}return n}}}]),angular.module("app_env").config(["$httpProvider",function(o){o.defaults.withCredentials=!0,o.defaults.xsrfCookieName="csrftoken",o.defaults.xsrfHeaderName="X-CSRFToken",o.defaults.headers.post["X-CSRFToken"]=getCookie("csrftoken")}]);